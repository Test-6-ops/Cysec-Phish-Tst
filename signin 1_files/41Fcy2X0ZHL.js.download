(function(h){var p=window.AmazonUIPageJS||window.P,q=p._namespace||p.attributeErrors,r=q?q("AuthXClaimCollectionUIAssets",""):p;r.guardFatal?r.guardFatal(h)(r,window):r.execute(function(){h(r,window)})})(function(h,p,q){function r(f,b){f.logEvent({metricName:"ClientEvent:"+b})}h.when("A","jQuery","a-button","a-spinner","authx-claim-collection-alerts","authx-claim-collection-input","authx-claim-collection-csm","authx-claim-collection-csrf-token","authx-claim-collection-beacon","authx-claim-collection-validation",
"authx-password-encryption","authx-claim-collection-password-input-handler","ready").register("authx-claim-collection-controller",function(f,b,d,a,c,g,e,l,k,m,n,u){function z(){var a=b("#claim-submit-button");return a.length?a:b("#continue")}function w(){return g.type()===g.inputTypes.PHONE?"phoneNumber":"email"}function v(a){var b;p.location.search.replace("?","").split("\x26").reduce(function(c,e){c=e.split("\x3d");c[0]===a&&(b=c[1])},{});return typeof b?encodeURIComponent(b):""}function y(a){f.trigger("in-context-auth-error-event",
a)}function D(a){h();if(a){if(a.model){if(a.model.error){e.logCount(e.metrics.FORM_SUBMIT_INVALID_CLAIM);try{g.type()===g.inputTypes.PHONE?c.showAlert(c.alertTypes.INVALID_PHONE_ALERT):c.showAlert(c.alertTypes.INVALID_EMAIL_ALERT)}catch(K){G("Error: Exception in showInvalidClaimAlert method.",K)}return}if(a.model.redirectToUrl&&"formSubmitPost"===a.model.redirectMethod){a=JSON.parse(a.model.payload);try{var d='\x3cform name\x3d"redirect-form" style\x3d"display: none;" action\x3d"'+a.redirectToUrl+
'" method\x3d"post"\x3e',m;for(m in a)d=d+'\x3cinput type\x3d"hidden" name\x3d'+m.toString()+' value\x3d"'+a[m].toString()+'" /\x3e';!a.step||"register"!==a.step&&"IntentPageRedirect"!==a.step||(d=d+'\x3cinput type\x3d"hidden" name\x3d"anti-csrftoken-a2z" value\x3d"'+l.getValue()+'" /\x3e');var D=u.getValue();D&&(d=d+'\x3cinput type\x3d"hidden" id\x3d"ap_password" name\x3d"password" value\x3d"'+D+'" /\x3e');var v=b(d+"\x3c/form\x3e");b("#claim-collection-container").append(v);D?n.submit_encrypted_form(v.get(0)):
v.submit()}catch(K){G("Error: Exception in redirectUsingFormSubmit method.",K)}return}}e.logCount(e.metrics.FORM_SUBMIT_VALID_CLAIM);f.trigger("in-context-auth-content-update-event",a)}else e.logError(Error("empty response from server"),e.metrics.FORM_SUBMIT_ERROR)}function L(a){e.logError(a,e.metrics.FORM_SUBMIT_ERROR);c.showAlert(c.alertTypes.ERROR_ALERT);q("SUBMIT","SERVER_ERROR",e.metrics.FORM_SUBMIT_ERROR);h();y({message:"Error processing the claim form on the server."})}function G(a,b){a={message:a,
cause:b};e.logError(b,e.metrics.FORM_SUBMIT_EXCEPTION);c.showAlert(c.alertTypes.ERROR_ALERT);q("SUBMIT","EXCEPTION",e.metrics.FORM_SUBMIT_EXCEPTION);h();y(a)}function h(){a(H).hide();d(C).enable()}function q(a,b,c){k.logEvent({kinesisAction:{pageType:"CLAIM",pageAction:b,appAction:a},metricName:"ClientEvent:"+c})}var r=b("#claim-collection-form");r.length||(r=b("#ap_login_form"));var x=b("#claim-input-dropdown-select-element"),C=z(),H=b("#claim-submit-spinner"),N=b("input[name\x3dclaimCollectionWorkflow]"),
I=b("input[name\x3dunifiedAuthTreatment]"),t=b("input[name\x3dmetadata1]"),E=b("input[name\x3daaToken]"),F=b("input[name\x3disServerSideRouting]"),O=b("input[name\x3dclaimType]"),S=b("input[name\x3dcountryCode]");return{getQueryParam:v,refreshController:function(){try{c.refreshAlerts();g.refreshInput();var y=b("#claim-collection-form");y.length||(y=b("#ap_login_form"));x=b("#claim-input-dropdown-select-element");x.change(function(){e.logCount(e.metrics.COUNTRY_CODE_DROP_DOWN_USE)});C=z();H=b("#claim-submit-spinner");
F=b("input[name\x3disServerSideRouting]");y.submit(function(b){e.logCount(e.metrics.FORM_SUBMIT_BUTTON_PRESS);try{var c=m.validate();if(c.validClaim){var y=c.validClaim,k=c.countryCode;if("true"===F.val())try{g.setVal(y),S.val(k),O.val(w()),u.getValue()?(b.preventDefault(),n.submit_encrypted_form(r.get(0))):u.clearValue()}catch(P){G("Error: Exception in prepareForFormSubmit method.",P)}else{b.preventDefault();try{var z=r.attr("action"),T=v("openid.assoc_handle"),h=N.val(),p=I.val(),q=t.val();var J=
E?E.val():null;var x={claim:y,"openid.assoc_handle":T,claimType:w(),claimCollectionWorkflow:h,countryCode:k,metadata1:q,aaToken:J};p&&(x.unifiedAuthTreatment=p);d(C).disable();a(H).show();f.post(z,{params:x,headers:{"anti-csrftoken-a2z":l.getValue()},success:D,error:L})}catch(P){G("Error: Exception in submitClaimToServer method. Unable to submit claim to server.",P)}}}else b.preventDefault()}catch(P){G("Error: Exception in handleClaimSubmit method.",P)}})}catch(M){G("Error: Exception in refreshController method.",
M)}}}});"use strict";h.when("A","jQuery","a-text-input","authx-claim-collection-alerts","authx-claim-collection-csm","authx-email-domain-autocomplete","authx-claim-collection-beacon","ready").register("authx-claim-collection-input",function(f,b,d,a,c,g,e){function l(a){a=a?":"+a:"";try{var c=b("#claim-input"+a);c.length||(c=b("#ap_email_login"+a));return c}catch(U){return[]}}function k(){H=b("#claim-input-container");N=b("#claim-input-dropdown");I=b("#claim-input-clear-button");t=new d(l());E=b("input[name\x3dcheckout-store-html-url]");
F=b("#claim-input-dropdown-select-element");O=b("#claim-input-container .a-dropdown-container");B=A.EMAIL;x()||(h(),B=C()?A.PHONE:A.EMAIL,v(B));m(t);!M&&E.val()&&(R=setTimeout(w,6E4));f.capabilities.mobile||setTimeout(L,500);t.on("focus",function(a){H.addClass("a-form-focus")});t.on("focusout",function(a){H.removeClass("a-form-focus")});t.on("keydown",function(a){if(32===a.which&&B!==A.PHONE)return!1});F.focus(function(){O.addClass("a-form-focus")});F.focusout(function(){O.removeClass("a-form-focus")});
I.click(function(){D();I.hide();L()});t.on("input",function(){});q(n);r(z)}function m(a){function b(){return!K&&l("-webkit-autofill").length?(e.logEvent(d),K=!0):!1}var d={kinesisAction:{pageType:"CLAIM",pageAction:"RENDER",appAction:"INPUT"},metricName:"ClientEvent:"+c.metrics.INPUT_AUTOFILL};if(!b())a.on("input.autofill",function(){setTimeout(function(){b()&&a.off("input.autofill")},50)})}function n(a){z(a);u()}function u(){if(E.val()){var a=l().val();b(5>M)&&a&&(b.ajax({url:"/gp/checkoutprefetch/change-email.html",
data:{email:a},headers:{"Cache-Control":"no-cache",pragma:"no-cache"}}),R&&clearTimeout(R),M++)}}function z(b){C()&&!x()?v(A.PHONE):v(A.EMAIL);x()?I.hide():h();x()&&13===b.which||x()&&a.clearAlerts()}function w(){E.val()&&(b("body").append('\x3ciframe sandbox src\x3d"'+E.val()+'" style\x3d"width:0; height:0; display:none"\x3e\x3c/iframe\x3e'),Q++,5>Q&&(R=setTimeout(w,6E4)))}function v(a){B=a;var d=B,e=b("#email-tab"),f=b("#phone-tab");if(e.length||f.length)a=l(),C()&&d!==A.EMAIL||d==A.PHONE&&!x()?
(f.click(),1==p().length&&(a.focus(),d=p(),a.val(""),a.val(d)),a.focus()):0<a.length&&"+"==t.val().charAt(0)?(f.click(),a.val("+")):""===p()||C()||e.click();B!=A.PHONE||y()?(N.addClass("aok-hidden"),F.addClass("aok-hidden")):(c.logCount(c.metrics.COUNTRY_CODE_DROP_DOWN),N.removeClass("aok-hidden"),F.removeClass("aok-hidden"));g.handleEmailClaimInputChange(B==A.EMAIL)}function y(){var a=l();a=a.val()&&a.val().trim()||"";return 0===a.indexOf("+")||0===a.indexOf("00")}function D(){t.val("")}function L(){t.focus()}
function h(){x()||I.show()}function p(){return t.val()}function q(a){t.off("change");t.on("change",a)}function r(a){t.off("keyup");t.on("keyup",a)}function x(){return!t||!t.val()||!t.val().trim()}function C(){var a=l().val();return S.test(a.trim())}var H,N,I,t,E,F,O,S=/^[()\s.0-9-\+]*\d[()\s.0-9-\+]*$/,Q=1,M=0,R,B,A={EMAIL:"email",PHONE:"tel"},K=!1;k();return{clear:D,focus:L,handleEmailChange:u,inputTypes:A,isClaimEmpty:x,isClaimValidPhoneNumber:C,setChangeHandler:q,setInputType:v,setKeyupHandler:r,
setProp:function(a,b){t.prop(a,b)},showClearButton:h,isCountryCodePrefixed:y,type:function(){return B},val:p,setVal:function(a){return t.val(a)},refreshInput:k}});"use strict";h.when("A","jQuery","a-text-input","authx-claim-collection-input","ready").register("authx-claim-collection-tabs",function(f,b,d,a){function c(){g();a.handleEmailChange()}function g(){a.showClearButton();if(k!==l.EMAIL&&!a.isClaimValidPhoneNumber()){a.setInputType(a.inputTypes.EMAIL);a.setProp("type",a.inputTypes.EMAIL);var c=
b("#"+l.PHONE),d=b("#"+l.EMAIL);d.hasClass("a-active")||(d.addClass("a-active"),d.children("a").attr("aria-selected","true").removeAttr("tabindex"),c.removeClass("a-active"),c.children("a").attr("aria-selected","false").attr("tabindex","-1"),k=l.EMAIL)}}var e=b("#claim-collection-tab-container");d=new d("#claim-input");var l={PHONE:"phone-tab",EMAIL:"email-tab"},k=l.PHONE;d.data("tab-layout-weblab-treatment");0<e.length&&(a.setInputType(a.inputTypes.PHONE),a.setProp("type",a.inputTypes.PHONE),a.setKeyupHandler(g),
a.setChangeHandler(c));f.on("a:tabs:claim-collection-tabs:default:select",function(c){c=c.selectedTab.$tab[0].id;c!==k&&(c===l.PHONE?(a.isClaimValidPhoneNumber()||a.clear(),a.setInputType(a.inputTypes.PHONE)):a.setInputType(a.inputTypes.EMAIL),k=c,a.setProp("type",a.type()),c=b("\x3cinput /\x3e"),c.appendTo(e),c.focus(),a.focus(),c.remove())})});"use strict";h.when("A","jQuery","a-alert","ready").register("authx-claim-collection-alerts",function(f,b,d){function a(){g();l.hide();n.hide();k.hide();
m.hide()}function c(){e.addClass("a-form-error")}function g(){e.removeClass("a-form-error")}var e=b("#claim-input-container"),l=d("#empty-claim-alert"),k=d("#invalid-phone-alert"),m=d("#invalid-email-alert"),n=d("#error-alert");return{clearAlerts:a,hideError:g,showAlert:function(b){a();d(b).show();c()},showError:c,alertTypes:{EMPTY_CLAIM_ALERT:"#empty-claim-alert",INVALID_PHONE_ALERT:"#invalid-phone-alert",INVALID_EMAIL_ALERT:"#invalid-email-alert",ERROR_ALERT:"#error-alert"},refreshAlerts:function(){e=
b("#claim-input-container");l=d("#empty-claim-alert");k=d("#invalid-phone-alert");m=d("#invalid-email-alert");n=d("#error-alert")}}});"use strict";h.register("authx-claim-collection-csm",function(){function f(b,d){p.ue&&p.ue.count&&p.ue.count(b,d||1)}return{metrics:{FORM_SUBMIT_BUTTON_PRESS:"AuthX:ClaimCollection:FormSubmit:ButtonPress",FORM_SUBMIT_VALID_CLAIM:"AuthX:ClaimCollection:FormSubmit:Success:ValidClaim",FORM_SUBMIT_INVALID_CLAIM:"AuthX:ClaimCollection:FormSubmit:Success:InvalidClaim",FORM_SUBMIT_ERROR:"AuthX:ClaimCollection:FormSubmit:Error",
FORM_SUBMIT_EXCEPTION:"AuthX:ClaimCollection:FormSubmit:Exception",COUNTRY_CODE_DROP_DOWN:"AuthX:ClaimCollection:CountryCode:Dropdown:Shown",COUNTRY_CODE_DROP_DOWN_USE:"AuthX:ClaimCollection:CountryCode:Dropdown:Used",INPUT_AUTOFILL:"AuthX:ClaimCollection:Input:Autofill",INPUT_VALID_EMAIL:"AuthX:ClaimCollection:Input:Valid:Email",INPUT_VALID_PHONE:"AuthX:ClaimCollection:Input:Valid:Phone",INPUT_INVALID_EMAIL:"AuthX:ClaimCollection:Input:Invalid:Email",INPUT_INVALID_PHONE:"AuthX:ClaimCollection:Input:Invalid:Phone",
BEACON_UNSUPPORTED:"AuthX:ClaimCollection:Beacon:Unsupported",BEACON_FALLBACK:"AuthX:ClaimCollection:Beacon:Fallback",BEACON_FALLBACK_ERROR:"AuthX:ClaimCollection:Beacon:FallbackError",BEACON_FALLBACK_ERROR_PREFIX:"AuthX:ClaimCollection:Beacon:FallbackError:",BEACON_FALLBACK_ERROR_NOT_OK:"AuthX:ClaimCollection:Beacon:FallbackError:NotOk",PASSWORD_ENCRYPTION_FAILED:"AuthX:ClaimCollection:FormSubmit:PasswordEncryptionFailed",EMAIL_DOMAIN_AUTOCOMPLETE:"AuthX:ClaimCollection:EmailDomainAutocomplete:Shown",
EMAIL_DOMAIN_AUTOCOMPLETE_SELECTED:"AuthX:ClaimCollection:EmailDomainAutocomplete:Selected"},logCount:f,logError:function(b,d){p.ueLogError&&p.ueLogError({message:b},{logLevel:"ERROR",attribution:d})},incrementAndLogCount:function(b){if(p.ue&&p.ue.count){var d=1;"function"===typeof ue.count&&(d=(ue.count(b)||0)+1);f(b,d)}}}});"use strict";h.when("A","jQuery","authx-claim-collection-alerts","authx-claim-collection-input","authx-claim-collection-csm","authx-claim-collection-beacon","IdentityCommon",
"ready").register("authx-claim-collection-validation",function(f,b,d,a,c,g,e){return{validate:function(){var f=b("#claim-input-dropdown-select-element"),k=a.val();d.clearAlerts();if(a.isClaimEmpty())return d.showAlert(d.alertTypes.EMPTY_CLAIM_ALERT),{claim:q};var m=k;if(e.getEmailUtil().isEmailValid(m.trim())||Q.test(m.trim()))a.type()===a.inputTypes.PHONE?(c.logCount(c.metrics.INPUT_VALID_PHONE),r(g,c.metrics.INPUT_VALID_PHONE)):(c.logCount(c.metrics.INPUT_VALID_EMAIL),r(g,c.metrics.INPUT_VALID_EMAIL));
else return a.type()===a.inputTypes.PHONE?(c.logCount(c.metrics.INPUT_INVALID_PHONE),r(g,c.metrics.INPUT_INVALID_PHONE)):(c.logCount(c.metrics.INPUT_INVALID_EMAIL),r(g,c.metrics.INPUT_INVALID_EMAIL)),a.type()===a.inputTypes.PHONE?d.showAlert(d.alertTypes.INVALID_PHONE_ALERT):d.showAlert(d.alertTypes.INVALID_EMAIL_ALERT),{claim:q};m="";Q.test(k.trim())&&(a.isCountryCodePrefixed()?(0===k.indexOf("00")&&(k=k.replace("00","+")),m=""):(k="+"+f.find(":selected").data("calling-code")+k,m=f.find(":selected").val()));
return{validClaim:k,countryCode:m}}}});var Q=/^\+?[()\s.0-9-]*\d[()\s.0-9-]*$/;"use strict";h.when("jQuery","IdentityWebAuthn","SignInWithPasskeyUtilities","IdentityCommon","PasskeyStateStore","A","ready").register("auth-signin-passkey-autofill",function(f,b,d,a,c,g){function e(){var a=new AbortController,c=g.state("unified-auth-autofill-credential-state"),e=["passkey"];c&&c.isPasswordAutoFillEnabled&&c.isPasswordAutofillWithPasskeyEnabled&&e.push("password");c={serializedCredentialParameters:n.val(),
challengeId:u.val(),arb:z.val(),signal:a.signal,actionIdForMetrics:w,operationNameForMetrics:"Autofill",autofillMode:e};f('[name\x3d"signIn"] #continue').click(function(){a.abort(d.passkeyAutoFillAbortOnContinueClickReason)});b.getWebAuthn().signInWithPasskey(c).then(function(a){v.publishCounterOnce("SignInWithPasskey:Attempt:Autofill");d.handleFetchPasskeySignInResponse(a,"signIn",v)}).catch(function(a){console.error(a);v.publishCounterOnce("Error:FetchAssertion")})}function l(){try{var a=g.state("mobileSDCConfigMap").mobileSDCConfigKey;
if(null===a||a===q||""===a.trim())v.publishCounterOnce("InjectMobileSDCError:MissingConfig");else{var c=atob(a),d=JSON.parse(c);b.getWebAuthn().injectConfiguration({android_app:{nativeEnable:d.android.enabled,useNativeBridgeForSignIn:d.android.useNativeBridgeforSignIn,useNativeBridgeForAutofill:d.android.useNativeBridgeforAutoFill,useNativeBridgeForEnroll:d.android.useNativeBridgeforEnroll,enrollmentWeblabsResult:d.android.enrollmentWeblabsResult,launchedApps:d.android.launchedApps},ios_app:{nativeEnable:d.ios.enabled,
useNativeBridgeForSignIn:d.ios.useNativeBridgeforSignIn,useNativeBridgeForAutofill:d.ios.useNativeBridgeforAutoFill,useNativeBridgeForEnroll:d.ios.useNativeBridgeforEnroll,enrollmentWeblabsResult:d.ios.enrollmentWeblabsResult,launchedApps:d.ios.launchedApps},app_name:"_authx_signin_autofill"})}}catch(G){v.publishCounterOnce("InjectMobileSDCError")}}var k=f("#ap_email_login");if(k.length){var m=a.getCookieHelper().getCookieValue("session-id");(function(c){c=a.getMetricsPublisher("IdentityService.Passkey.SignIn",
"AuthXClaimUIService","Eligible",c);b.getWebAuthn().reportDevicePasskeyCapability(c)})(m);m=a.getMetricsPublisher("IdentityService.Passkey.SignIn","AuthXClaimUIService","ConditionalCreate",m);(function(a){return b.getWebAuthn().getClientCapabilities(a).then(function(b){b=b.isSuccess&&b.clientCapabilities.conditionalCreate;a.publishCounterOnce(b?"Eligible":"Ineligible");b&&c.setIsConditionalCreateEligible()}).catch(function(b){a.publishCounterOnce("UnexpectedError:GetClientCapabilities");b instanceof
Error&&a.publishString(b.name,b.message);console.error(b)})})(m);(function(a){f('[name\x3d"signIn"] #continue').click(function(){try{var d;(d=c.isAutoFillFromCredentialManager())||(d=k?k.hasClass("autofill-test")||k.is(":-webkit-autofill"):!1);a.publishCounterOnce(d?"SignIn:ClaimWasAutofilled":"SignIn:ClaimWasNotAutofilled");var e=c.isConditionalCreateEligible(),f={};d&&(f.af="1");e&&(f.cc="1");(e||d)&&b.getWebAuthn().addToPasskeyEligibilityCookie(f,a);d&&e?a.publishCounterOnce("PasswordAutofill:EligibleForAutoEnroll"):
a.publishCounterOnce("PasswordAutofill:IneligibleForAutoEnroll")}catch(J){a.publishCounterOnce("PasskeyCookie:Set:Error"),J instanceof Error&&a.publishString("PasskeyCookie:Set:Error:"+J.name,J.message),console.error(J)}})})(m);var n=f("input[type\x3dhidden][name\x3dwebAuthnGetParametersForAutofill]"),u=f("input[type\x3dhidden][name\x3dwebAuthnChallengeIdForAutofill]"),z=f("input[type\x3dhidden][name\x3dwebAuthnGetArbForAutofill]");if(n.length&&u.length){var w=u.val(),v=a.getMetricsPublisher("IdentityService.Passkey.ClaimCollection",
"AuthXClaimUIService","Autofill",w);a.getPlatformDetector().isRunningInWebView()&&l();b.getWebAuthn().isWebAuthnSupported({actionId:w,requireConditionalMediationAvailable:!0,requireOnDeviceAuthenticatorAvailable:!1}).then(function(a){a&&e()}).catch(function(a){console.error(a)})}}});"use strict";h.when("jQuery","IdentityWebAuthn","IdentityCommon","A","ready").register("passkey-client-side-eligibility-cookie",function(f,b,d,a){function c(){try{if(a.state("mobileSDCConfigMap")){if(a.state("mobileSDCConfigMap").mobileSDCConfigKey){var b=
a.state("mobileSDCConfigMap").mobileSDCConfigKey,c=atob(b),d=JSON.parse(c);return{android_app:{nativeEnable:d.android.enabled,launchedApps:d.android.launchedApps},ios_app:{nativeEnable:d.ios.enabled,launchedApps:d.ios.launchedApps}}}e.publishCounterOnce("MissingMobileSDCConfigKey")}else e.publishCounterOnce("MissingMobileSDCConfigMap")}catch(n){e.publishCounterOnce("ParseMobileSDCError")}}function g(a){try{b.getWebAuthn().setPasskeyEligibilityCookie({isWebAuthnSupportedMobileConfig:a})}catch(k){e.publishCounterOnce("ErrorSettingCookie")}}
if(f("#ap_email_login").length){var e=d.getMetricsPublisher("IdentityService.Passkey.Eligibility","AuthXClaimUIService","SetEligibilityCookie",q);d.getPlatformDetector().isRunningInWebView()?(f=c())&&g(f):g()}});"use strict";h.when("A","a-alert","authx-claim-collection-csm","authx-claim-collection-password-input-handler").register("SignInWithPasskeyUtilities",function(f,b,d,a){function c(a,b,c){b=g(b);b.completePasskeyChallengeArb=a.arb;f.post("/ap/signin/start",{params:b,success:function(a){var b=
"object"===typeof a;b&&"redirect"in a?(c.publishCounterOnce("RedirectFromFinalization"),p.location.href=a.redirect):b&&"error"in a?(k(n.clientErrorMessage()),k(n.genericServerErrorMessage()),"string"===typeof a.errorTitle&&u.heading(a.errorTitle),b=n.serverErrorMessage(),b.text(a.error),l(b),l(n.passkeyAlert()),c.publishCounterOnce("Error:StartSignIn:"+a.error)):(e(),console.warn("Unexpected response from /ap/signin/start!"),c.publishCounterOnce("Error:StartSignIn:UnexpectedResponse"))},timeout:5E3,
error:function(a,b,d){e();console.warn("Error communicating with /ap/signin/start: "+d);c.publishCounterOnce("Error:StartSignIn:"+b)}})}function g(a){var b={};m("form[name\x3d"+a+"] \x3e input[type\x3dhidden]").each(function(){b[this.name]=this.value});return b}function e(){k(n.clientErrorMessage());k(n.serverErrorMessage());u.heading(z);l(n.genericServerErrorMessage());l(n.passkeyAlert())}function l(a){a.removeClass("aok-hidden")}function k(a){a.addClass("aok-hidden")}var m=f.$,n={passkeyAlert:function(){return m("#passkey-error-alert")},
clientErrorMessage:function(){return m("#passkey-client-error-message")},genericServerErrorMessage:function(){return m("#passkey-generic-server-error-message")},serverErrorMessage:function(){return m("#passkey-server-error-message")}},u=b("#passkey-error-alert"),z=u.heading();return{handleFetchPasskeySignInResponse:function(b,g,k){if(b.isSuccess)if(b.password_credential!==q){g=b.password_credential.id;b=b.password_credential.password;var l=f.$;l("#ap_email_login").attr("value",g).keyup();a.setValue(b);
b=l("#ap_login_form #continue input[type\x3dsubmit]");k.publishCounterOnce("PasswordAutofillClicked");b.click()}else return c(b,g,k);else g=b.errorCodes[0],0===g.indexOf("ServerError_")?(e(),k.publishCounterOnce("Error:FetchPasskeySignIn:"+g),console.debug("Sign-in with passkey failed: "+b.errorCodes)):"ClientError_AbortError"===g?"AbortFromContinueButtonClick"!==b.abortReason&&(console.debug("The abort reason is not from continue button click, abort reason: "+b.abortReason),d.logCount("UnknownAbortReason:"+
b.abortReason)):k.publishCounterOnce("Error:FetchPasskeySignIn:"+g)},passkeyAutoFillAbortOnContinueClickReason:"AbortFromContinueButtonClick"}});"use strict";h.when("A","jQuery","ready").register("authx-intent-confirmation-controller",function(f,b){function d(a){f.ajax(a,{method:"GET",dataType:"html",success:function(a){f.trigger("in-context-auth-content-update-event",a)},error:function(){console.error("AJAX request to /ax/claim/ica failed.",this.error)}})}var a=b(".change-claim"),c=b(".signin-with-another-account");
return{intentConfirmationListenersInitializer:function(){a=b(".change-claim");c=b(".signin-with-another-account");a.click(function(){var a=b("input[name\x3dchangeClaimUrl]").val();d(a)});c.click(function(){var a=b("input[name\x3dsignInWithAnotherClaimUrl]").val();d(a)});f.trigger("in-context-auth-content-ready-event")}}});"use strict";h.when("A","jQuery","IdentityCommon","authx-claim-collection-password-input-handler","ready").register("authx-autofill-password-handler",function(f,b,d,a){var c={passwordField:null,
metricsPublisher:null,init:function(){var b=a.getPasswordFieldElement();this.isEligible()&&0!=b.length&&(this.createMetricsPublisher(),this.passwordField=b.get(0),this.bindEvents())},isEligible:function(){var a=f.state("unified-auth-autofill-credential-state");return a&&!0===a.isPasswordAutofillAndAutoSubmitEligible},bindEvents:function(){this.passwordField&&this.passwordField.addEventListener("input",this.handleInput.bind(this))},handleInput:function(){""!==this.passwordField.value?(this.pushMetrics("AutofillDetected"),
this.autoSubmit()):this.pushMetrics("Failed:PasswordIsNotAutofilled")},autoSubmit:function(){this.pushMetrics("SubmitSuccess");b("#ap_login_form").submit()},createMetricsPublisher:function(){this.metricsPublisher=d.getMetricsPublisher("IdentityService.PasswordAutofill.ClaimCollection","AuthXClaimUIService","Autofill",q)},pushMetrics:function(a){this.metricsPublisher?this.metricsPublisher.publishCounterOnce("AutofillPasswordHandler."+a):console.error("Metrics Publisher not initialized")}};c.init();
return c});"use strict";h.when("A","authx-claim-collection-form-data","authx-claim-collection-csrf-token","authx-claim-collection-csm","ready").register("authx-claim-collection-beacon",function(f,b,d,a){function c(b,c,d){try{var e={};e["anti-csrftoken-a2z"]=c;e.events=JSON.stringify([d]);fetch(b,{method:"POST",headers:{"Content-Type":"multipart/form-data; boundary\x3d----IdentityBeaconFormBoundary"},body:g(e)}).then(function(b){b.ok||(a.logCount(a.metrics.BEACON_FALLBACK_ERROR_PREFIX+(b.status||"Unknown")),
a.logCount(a.metrics.BEACON_FALLBACK_ERROR_NOT_OK))}).catch(function(b){a.logCount(a.metrics.BEACON_FALLBACK_ERROR)})}catch(u){a.logCount(a.metrics.BEACON_FALLBACK_ERROR)}}function g(a){var b="",c;for(c in a)b+='------IdentityBeaconFormBoundary\r\nContent-Disposition: form-data; name\x3d"'+c+'"\r\n\r\n'+a[c]+"\r\n";return b+"------IdentityBeaconFormBoundary--\r\n"}var e;(e=!!navigator.sendBeacon)||a.logCount(a.metrics.BEACON_UNSUPPORTED);return{logEvent:function(f){if(e)if(f)try{var g=b.create();
g.set("anti-csrftoken-a2z",d.getValue()||"");g.set("events",JSON.stringify([f]));navigator.sendBeacon("/ax/claim/log",g)}catch(m){a.logCount(a.metrics.BEACON_FALLBACK),c("/ax/claim/log",d.getValue()||"",f)}else console.error("ignoring sendBeacon for undefined or empty event")}}});"use strict";h.when("A","ready").register("authx-claim-collection-csrf-token",function(f){var b=f.$;return{getValue:function(){var d=b("#ap_login_form input[name\x3danti-csrftoken-a2z]");return d&&d.val()?d.val():b("input[name\x3dcsrf-token]").val()}}});
"use strict";h.register("authx-claim-collection-form-data",function(){return{create:function(){return new FormData}}});"use strict";h.when("A","jQuery","ready").register("authx-claim-collection-password-input-handler",function(f,b){function d(){return b('.auth-fill-password input[name\x3d"password"]')}return{getValue:function(){var a=d();return a.length&&a.val().length?a.val():""},setValue:function(a){var b=d();b.length&&b.val(a)},clearValue:function(){var a=b('input[name\x3d"password"]');a.length&&
a.val().length&&a.val("")},getPasswordFieldElement:d}});"use strict";h.when("A","authx-claim-collection-csm","authx-claim-collection-password-input-handler","ready").register("unified-auth-autofill-ios",function(f,b,d){var a=f.$;f=f.state("unified-auth-autofill-credential-state");var c=a("#ap_email_login[autocomplete\x3dusername]");if(c.length){var g=a("input[type\x3dhidden][name\x3dwebAuthnGetParametersForAutofill]"),e=a("input[type\x3dhidden][name\x3dwebAuthnChallengeIdForAutofill]");if(!g.length||
!e.length){var l=a("#ap_login_form #continue input[type\x3dsubmit]");p.isPrepopulateEnabled=f!==q?f.isPrepopulateEnabled:!1;p.prepopulateEmailAndPassword=function(a){b.incrementAndLogCount("MAPIOSPrepopulateEmailAndPasswordCredential");!0===p.isPrepopulateEnabled&&(c.attr("value",a.userId).keyup(),a.password&&a.password.length&&d.setValue(a.password),l.click())}}}});"use strict";h.when("A","authx-claim-collection-csm","authx-claim-collection-beacon","ready").register("authx-password-encryption",function(f,
b,d){function a(a,b){b='\x3cinput type\x3d"hidden" name\x3d"'+b+'" value\x3d"true" /\x3e';f.$(a).append(b)}return{submit_encrypted_form:function(c){function g(a){b.logError(Error("password encryption error"),b.metrics.PASSWORD_ENCRYPTION_FAILED);d.logEvent({kinesisAction:{pageType:"CLAIM",pageAction:"RENDER",appAction:"SUBMIT"},metricName:"ClientEvent:"+b.metrics.PASSWORD_ENCRYPTION_FAILED});c.submit()}a(c,"encryptedPasswordExpected");var e=f.state("sif-encryption-profile");if(!e)return g();h.now("siege-cse:profile:"+
e.sifProfile).execute("password-encryption",function(b){if(b===q)return g();try{var d=b.createFormHandler(c);d.configure({formProfile:e.sifProfile,encryptionContext:{}});var l=f.$(c).find("input[name\x3d'password']"),n=l.length?(l.val()||"").length:0;if(0===n)return c.submit();d.generateProcessedForm({},!0).then(function(b){f.$(b).find("input[name\x3d'password']").val().length===n&&a(b,"passwordNotEncrypted");var c=f.$(b).find("input[name\x3d'password']");c.length&&(c.get(0).name="encryptedPwd");
b.submit()},function(a){g(a)})}catch(u){g(u)}})}}});h.when("A","jQuery","authx-claim-collection-csm","authx-email-domain-autocomplete-common","ready").register("authx-email-domain-autocomplete",function(f,b,d,a){function c(){k||a.logEvent("RENDER","INPUT",d.metrics.EMAIL_DOMAIN_AUTOCOMPLETE);n.removeClass("aok-hidden");n.attr("aria-hidden","false");h.removeClass("firstElement middleElement lastElement");var b=h.not(".aok-hidden");b.first().addClass("firstElement").end().last().addClass("lastElement");
2<b.length&&b.slice(1,-1).addClass("middleElement");k=!0}function g(){n.addClass("aok-hidden");n.attr("aria-hidden","true");h.addClass("aok-hidden");h.attr("aria-hidden","true");l();k=!1}function e(a,b,c){b&&0!==b.length&&(a.preventDefault(),m=-1===m&&-1===c?b.length-1:(m+c+b.length)%b.length,b.removeClass("email-suggestion-focus"),b.eq(m).addClass("email-suggestion-focus"))}function l(){m=-1;h.removeClass("email-suggestion-focus")}var k=!1,m=-1;var n=b("#email-autocomplete-desktop-container");var h=
b("#email-autocomplete-desktop-container .email-suggestion");(function(){a.emailInputField.on("keydown",function(b){var c=h.not(".aok-hidden");switch(b.which){case 40:e(b,c,1);break;case 38:e(b,c,-1);break;case 13:-1!==m&&(b.preventDefault(),b=c.eq(m).data("emaildomain"),a.applyEmailDomainSuggestion(b));break;default:l()}});a.emailInputField.on("focusout",function(){g()})})();return{handleEmailClaimInputChange:function(d){if(d&&a.shouldDisplayEmailSuggestions()){var e=a.emailInputField.val();d=e.indexOf("@");
var f=-1!==d?e.slice(d):"";e=-1!==d?e.slice(0,d):e;b(".email-suggestion-prefix").text(e);-1===d||1===f.length?(h.removeClass("aok-hidden"),h.attr("aria-hidden","false"),c()):a.processMatchingDomains(f,"#email-autocomplete-desktop-container")?c():g()}else g()}}});h.when("A","jQuery","a-text-input","a-carousel-framework","authx-claim-collection-csm","authx-claim-collection-beacon","ready").register("authx-email-domain-autocomplete-common",function(f,b,d,a,c,g){function e(a){var b=n.val(),d=b.indexOf("@");
n.val(-1===d?b+a:b.substring(0,d)+a);k("RENDER","INPUT",c.metrics.EMAIL_DOMAIN_AUTOCOMPLETE_SELECTED);p&&h.click()}function l(a){var b={};a=a.toLowerCase();for(var c=0;c<w.length;c++){var d=w[c],e=d.toLowerCase();e=0===e.indexOf(a)&&e.length!==a.length;b[d]=e}return b}function k(a,b,c){g.logEvent({kinesisAction:{pageType:"CLAIM",pageAction:b,appAction:a},metricName:"ClientEvent:"+c})}var h,n,p,q,w;(function(){var a=f.state("emailDomainAutocompleteData")||{};p=a.autoSubmit||!1;q=a.requiresAtSign||
!0;w=a.emailDomainSuggestions||[];n=new d(b("#claim-input").length?b("#claim-input"):b("#ap_email_login"));h=b("#ap_login_form #continue input[type\x3dsubmit]")})();f.declarative("autofill-email-domain","mousedown touchstart",function(a){a.$event.preventDefault()});f.declarative("autofill-email-domain","click",function(a){e(a.data.emailDomain)});return{shouldDisplayEmailSuggestions:function(){var a=0<w.length,b=n.val(),c=-1!==b.indexOf("@");return(c?3<=b.length:2<=b.length)&&a&&(!q||c)},emailInputField:n,
processMatchingDomains:function(a,c){var d=l(a);return Object.keys(d).reduce(function(a,e){var f=d[e];b(c+" [data-emaildomain\x3d'"+e+"']").toggleClass("aok-hidden",!f).attr("aria-hidden",!f);return a||d[e]},!1)},applyEmailDomainSuggestion:e,logEvent:k}});"use strict";h.when("A","a-alert","ready").register("guest-account-alerts",function(f,b){function d(){Object.keys(c).forEach(function(b){a(b)});Object.keys(g).forEach(function(a){g[a].hide()})}function a(a){c[a].removeClass("a-form-error")}var c=
{};c.email=f.$("#email-input-container");c.orderId=f.$("#order-id-input-container");var g={EMPTY_EMAIL:b("#empty-email-alert"),EMPTY_ORDER_ID:b("#empty-order-id-alert"),INVALID_INPUT:b("#invalid-input-alert"),ERROR:b("#error-alert")};return{alerts:g,showAlert:function(a){d();a.show()},showError:function(a){c[a].addClass("a-form-error")},hideError:a,clearAlerts:d}});"use strict";h.when("A","a-text-input","IdentityCommon","ready").register("guest-account-input",function(f,b,d){var a=/^[a-zA-Z0-9]\d{2}-\d{7}-\d{7}$/,
c={EMAIL:"email",ORDER_ID:"orderId"},g={};g[c.EMAIL]=f.$("#email-input-container");g[c.ORDER_ID]=f.$("#order-id-input-container");var e={};e[c.EMAIL]=new b(f.$("#email-input"));e[c.ORDER_ID]=new b(f.$("#order-id-input"));return{inputTypes:c,inputs:e,refreshInputs:function(){Object.keys(e).forEach(function(a){e[a].on("focus",function(){g[a].addClass("a-form-focus")});e[a].on("focusout",function(){g[a].removeClass("a-form-focus")})})},clearInput:function(a){e[a].val("")},isValidOrderId:function(){return a.test(e[c.ORDER_ID].val())},
isValidEmail:function(){var a=e[c.EMAIL].val();return d.getEmailUtil().isEmailValid(a.trim())}}});"use strict";h.when("A","a-button","a-spinner","guest-account-alerts","guest-account-input","ready").register("guest-sign-in-controller",function(f,b,d,a,c){var g=c.inputTypes,e=a.alerts,h=f.$("#guest-sign-in-form"),k=f.$("#continue"),m=f.$("#claim-submit-spinner");return{refreshController:function(){c.refreshInputs();h.submit(function(f){try{var h=c.inputs[g.EMAIL].val();b:{var l=c.inputs[g.ORDER_ID].val(),
n={};n[g.EMAIL]={isEmpty:""===h.trim(),isValid:c.isValidEmail(),emptyAlert:e.EMPTY_EMAIL};n[g.ORDER_ID]={isEmpty:""===l.trim(),isValid:c.isValidOrderId(),emptyAlert:e.EMPTY_ORDER_ID};for(var p in n){var q=n[p];if(q.isEmpty){a.showAlert(q.emptyAlert);a.showError(p);var r=!1;break b}if(!q.isValid){a.showAlert(e.INVALID_INPUT);a.showError(p);r=!1;break b}}r=!0}r?(b(k).disable(),d(m).show()):f.preventDefault()}catch(L){f.preventDefault(),a.showAlert(a.alerts.ERROR),d(m).hide(),b(k).enable()}});Object.keys(c.inputs).forEach(function(b){c.inputs[b].on("input",
function(){a.clearAlerts()})})}}});h.register("PasskeyStateStore",function(){var f={};return{setIsAutofillFromCredentialManager:function(){f.isAutofillFromCredentialManager=!0},isAutoFillFromCredentialManager:function(){return f.isAutofillFromCredentialManager},setIsConditionalCreateEligible:function(){f.conditionalCreateEligibility=!0},isConditionalCreateEligible:function(){return f.conditionalCreateEligibility}}})});